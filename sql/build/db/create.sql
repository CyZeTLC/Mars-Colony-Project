-- 1. Sitzung für Datumsformate konfigurieren
ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD HH24:MI:SS';
ALTER SESSION SET NLS_TIMESTAMP_FORMAT = 'YYYY-MM-DD HH24:MI:SS';

-- 2. Vorhandene Tabellen löschen
BEGIN
   FOR rec IN (SELECT table_name FROM user_tables WHERE table_name IN ('ABTEILUNG', 'ADRESSE', 'BAUT_AB', 'BERUFUNG', 'BEWOHNER', 'ENERGIEQUELLE', 'FAHRZEUGE', 'INVENTARLOG', 'IST_GELAGERT_IN', 'KOORDINATE', 'LAGER', 'MITARBEITER', 'RAUMFAHRZEUG', 'RESSOURCE', 'ROUTE', 'STADT', 'STADTINVENTAR', 'TRANSFERFENSTER', 'TRANSPORTIERT', 'TRANSPORTWEGE', 'VERSORGT_STADT')) LOOP
      EXECUTE IMMEDIATE 'DROP TABLE "' || rec.table_name || '" CASCADE CONSTRAINTS';
   END LOOP;
END;
/

-- 3. Tabellen erstellen
CREATE TABLE ABTEILUNG (
  BEREICH_ID NUMBER(11) NOT NULL,
  MITARBEITER_ID NUMBER(8,0) DEFAULT NULL,
  TAETIGKEIT VARCHAR2(4000) DEFAULT NULL,
  ABTEILUNG_NAME VARCHAR2(4000) DEFAULT NULL
);

CREATE TABLE ADRESSE (
  STADT_ID NUMBER(8,0) NOT NULL,
  ADRESSE_ID NUMBER(8,0) NOT NULL,
  STRA_E VARCHAR2(4000) DEFAULT NULL,
  HAUSNUMMER VARCHAR2(4000) DEFAULT NULL
);

CREATE TABLE BAUT_AB (
  BEREICH_ID NUMBER(11) NOT NULL,
  RESSOURCE_ID NUMBER(8,0) NOT NULL
);

CREATE TABLE BERUFUNG (
  BERUFUNG_ID NUMBER(11) NOT NULL,
  BERUFUNG_NAME VARCHAR2(4000) DEFAULT NULL,
  ARBEITSZEIT FLOAT DEFAULT NULL,
  ARBEITSZEIT_MODEL VARCHAR2(4000) DEFAULT NULL
);

CREATE TABLE BEWOHNER (
  ADRESSE_ID NUMBER(8,0) NOT NULL,
  BEWOHNER_ID NUMBER(8,0) NOT NULL,
  VORNAME VARCHAR2(4000) DEFAULT NULL,
  NACHNAME VARCHAR2(4000) DEFAULT NULL,
  GEB DATE DEFAULT NULL
);

CREATE TABLE ENERGIEQUELLE (
  EQ_ID NUMBER(11) NOT NULL,
  LAGER_ID NUMBER(8,0) DEFAULT NULL,
  AKTUELLE_LEISTUNG FLOAT DEFAULT NULL,
  KAPAZITAET_MAX FLOAT DEFAULT NULL,
  EQ_TYP VARCHAR2(4000) DEFAULT NULL
);

CREATE TABLE FAHRZEUGE (
  FAHRZEUG_ID NUMBER(11) NOT NULL,
  TPW_ID NUMBER(11) DEFAULT NULL,
  F_NAME VARCHAR2(4000) DEFAULT NULL,
  F_STATUS VARCHAR2(4000) DEFAULT NULL
);

CREATE TABLE INVENTARLOG (
  LOG_ID NUMBER(8,0) NOT NULL,
  RESSOURCE_ID NUMBER(8,0) DEFAULT NULL,
  INVENTAR_ID NUMBER(8,0) NOT NULL,
  DATUM DATE DEFAULT NULL
);

CREATE TABLE IST_GELAGERT_IN (
  LAGER_ID NUMBER(8,0) NOT NULL,
  RESSOURCE_ID NUMBER(8,0) NOT NULL
);

CREATE TABLE KOORDINATE (
  ID NUMBER(8,0) NOT NULL,
  BREITENGRAD NUMBER(8,0) DEFAULT NULL,
  LAENGENGRAD NUMBER(8,0) DEFAULT NULL
);

CREATE TABLE LAGER (
  LAGER_ID NUMBER(8,0) NOT NULL,
  KOORD_ID NUMBER(8,0) NOT NULL,
  LAGERTYP VARCHAR2(4000) DEFAULT NULL,
  GROE_E NUMBER(8,0) DEFAULT NULL
);

CREATE TABLE MITARBEITER (
  MITARBEITER_ID NUMBER(8,0) NOT NULL,
  BEREICH_ID NUMBER(11) DEFAULT NULL,
  BEWOHNER_ID NUMBER(8,0) NOT NULL,
  BERUFUNG_ID NUMBER(11) DEFAULT NULL,
  ABT_BEREICH_ID NUMBER(11) DEFAULT NULL,
  LOGIN VARCHAR2(4000) DEFAULT NULL,
  PASSWORT VARCHAR2(4000) DEFAULT NULL,
  GEHALT FLOAT DEFAULT NULL
);

CREATE TABLE RAUMFAHRZEUG (
  RF_ID NUMBER(11) NOT NULL,
  TPW_ID NUMBER(11) DEFAULT NULL,
  TREIBSTOFF_STAND FLOAT DEFAULT NULL,
  TRAGLAST_KG FLOAT DEFAULT NULL,
  RF_TYP VARCHAR2(4000) DEFAULT NULL,
  RF_STATUS VARCHAR2(4000) DEFAULT NULL
);

CREATE TABLE RESSOURCE (
  RESSOURCE_ID NUMBER(8,0) NOT NULL,
  INVENTAR_ID NUMBER(8,0) DEFAULT NULL,
  R_TYP VARCHAR2(4000) DEFAULT NULL,
  MENGE NUMBER(8,0) DEFAULT NULL,
  GEWICHT FLOAT DEFAULT NULL,
  VOLUMEN FLOAT DEFAULT NULL,
  ABLAUFDATUM DATE DEFAULT NULL,
  PRIORITAET NUMBER(11) DEFAULT NULL,
  MENGE_EINHEIT VARCHAR2(4000) DEFAULT NULL,
  MIN_SCHWELLENWERT NUMBER(11) DEFAULT NULL,
  VERBRAUCH_PRO_SOL NUMBER(11) DEFAULT NULL
);

CREATE TABLE ROUTE (
  ROUTE_ID NUMBER(11) NOT NULL,
  START_ID NUMBER(8,0) NOT NULL,
  END_ID NUMBER(8,0) NOT NULL
);

CREATE TABLE STADT (
  STADT_ID NUMBER(8,0) NOT NULL,
  STADT_NAME VARCHAR2(4000) DEFAULT NULL,
  KOORD_ID NUMBER(8,0) DEFAULT NULL
);

CREATE TABLE STADTINVENTAR (
  INVENTAR_ID NUMBER(8,0) NOT NULL,
  STADT_ID NUMBER(8,0) NOT NULL,
  KOORD_ID NUMBER(8,0) NOT NULL,
  PRIOITAT VARCHAR2(4000) DEFAULT NULL,
  VOLL NUMBER(6) DEFAULT NULL
);

CREATE TABLE TRANSFERFENSTER (
  TF_ID NUMBER(11) NOT NULL,
  START_DATUM DATE DEFAULT NULL,
  END_DATUM DATE DEFAULT NULL,
  TS_TYP VARCHAR2(4000) DEFAULT NULL
);

CREATE TABLE TRANSPORTIERT (
  FAHRZEUG_ID NUMBER(11) NOT NULL,
  RESSOURCE_ID NUMBER(8,0) NOT NULL
);

CREATE TABLE TRANSPORTWEGE (
  TPW_ID NUMBER(11) NOT NULL,
  MITARBEITER_ID NUMBER(8,0) NOT NULL,
  LAGER_ID NUMBER(8,0) DEFAULT NULL,
  FAHRZEUG_ID NUMBER(11) DEFAULT NULL,
  ROUTE_ID NUMBER(11) NOT NULL,
  RF_ID NUMBER(11) DEFAULT NULL,
  TF_ID NUMBER(11) DEFAULT NULL,
  STADT_ID NUMBER(8,0) DEFAULT NULL,
  DAUER NUMBER(11) DEFAULT NULL,
  STREACKEN_TYP VARCHAR2(4000) DEFAULT NULL,
  TPW_STATUS VARCHAR2(4000) DEFAULT NULL
);

CREATE TABLE VERSORGT_STADT (
  STADT_ID NUMBER(8,0) NOT NULL,
  EQ_ID NUMBER(11) NOT NULL
);

-- 4. Daten einfügen 
INSERT INTO ABTEILUNG (BEREICH_ID, MITARBEITER_ID, TAETIGKEIT, ABTEILUNG_NAME) VALUES (1, 1, 'Verwaltung von Ressourcen', 'Verwaltung');
INSERT INTO ABTEILUNG (BEREICH_ID, MITARBEITER_ID, TAETIGKEIT, ABTEILUNG_NAME) VALUES (2, 5, 'Abbau von Ressourcen', 'Bergbau');

INSERT INTO ADRESSE (STADT_ID, ADRESSE_ID, STRA_E, HAUSNUMMER) VALUES (1, 1, 'Kuppelring', 'A1');
INSERT INTO ADRESSE (STADT_ID, ADRESSE_ID, STRA_E, HAUSNUMMER) VALUES (2, 2, 'Versorgungsachse', 'B3');

INSERT INTO BEWOHNER (ADRESSE_ID, BEWOHNER_ID, VORNAME, NACHNAME, GEB) VALUES (1, 1, 'Lena', 'Kowalski', '2026-01-05');
INSERT INTO BEWOHNER (ADRESSE_ID, BEWOHNER_ID, VORNAME, NACHNAME, GEB) VALUES (2, 2, 'Noah', 'Hernandez', '2079-12-04');
INSERT INTO BEWOHNER (ADRESSE_ID, BEWOHNER_ID, VORNAME, NACHNAME, GEB) VALUES (2, 3, 'Tom', 'Coombs', '2007-05-04');

-- 5. Primary Keys und Constraints setzen
ALTER TABLE ABTEILUNG ADD PRIMARY KEY (BEREICH_ID);
ALTER TABLE ADRESSE ADD PRIMARY KEY (ADRESSE_ID);
ALTER TABLE BAUT_AB ADD PRIMARY KEY (BEREICH_ID, RESSOURCE_ID);
ALTER TABLE BERUFUNG ADD PRIMARY KEY (BERUFUNG_ID);
ALTER TABLE BEWOHNER ADD PRIMARY KEY (BEWOHNER_ID);
ALTER TABLE ENERGIEQUELLE ADD PRIMARY KEY (EQ_ID);
ALTER TABLE FAHRZEUGE ADD PRIMARY KEY (FAHRZEUG_ID);
ALTER TABLE INVENTARLOG ADD PRIMARY KEY (LOG_ID);
ALTER TABLE IST_GELAGERT_IN ADD PRIMARY KEY (LAGER_ID, RESSOURCE_ID);
ALTER TABLE KOORDINATE ADD PRIMARY KEY (ID);
ALTER TABLE LAGER ADD PRIMARY KEY (LAGER_ID);
ALTER TABLE MITARBEITER ADD PRIMARY KEY (MITARBEITER_ID);
ALTER TABLE RAUMFAHRZEUG ADD PRIMARY KEY (RF_ID);
ALTER TABLE RESSOURCE ADD PRIMARY KEY (RESSOURCE_ID);
ALTER TABLE ROUTE ADD PRIMARY KEY (ROUTE_ID);
ALTER TABLE STADT ADD PRIMARY KEY (STADT_ID);
ALTER TABLE STADTINVENTAR ADD PRIMARY KEY (INVENTAR_ID);
ALTER TABLE TRANSFERFENSTER ADD PRIMARY KEY (TF_ID);
ALTER TABLE TRANSPORTIERT ADD PRIMARY KEY (FAHRZEUG_ID, RESSOURCE_ID);
ALTER TABLE TRANSPORTWEGE ADD PRIMARY KEY (TPW_ID);
ALTER TABLE VERSORGT_STADT ADD PRIMARY KEY (STADT_ID, EQ_ID);

-- 6. Foreign Keys setzen
ALTER TABLE BEWOHNER ADD CONSTRAINT FK_BEWOHNER_ADRESSE FOREIGN KEY (ADRESSE_ID) REFERENCES ADRESSE (ADRESSE_ID);
ALTER TABLE MITARBEITER ADD CONSTRAINT FK_MITARBEITER_BEWOHNER FOREIGN KEY (BEWOHNER_ID) REFERENCES BEWOHNER (BEWOHNER_ID);

COMMIT;